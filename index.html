<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cognitive Processing Assessment | Official Report</title>
    
	<meta name="description" content="Official Certified Cognitive Assessment 2026. Measure your Fluid Intelligence and IQ Score instantly.">
	
    <script src="https://www.paypal.com/sdk/js?client-id=AWsLSgZRVeueciwYeLNRDZF4ZOFu5WTo9hzW-nQPdI4G2EtD6012XYLUZsPDZwI4yZIvQL_lA9uhItAW&currency=EUR"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
	
    <style>
        :root {
            --primary: #0f172a; /* Navy Dark */
            --accent: #3b82f6;  /* Blue Bright */
            --bg: #f8fafc;
            --shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--primary);
            margin: 0;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* HEADER */
        header {
            width: 100%;
            max-width: 800px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .logo { font-weight: 800; font-size: 1.4rem; letter-spacing: -0.5px; }
        
        #timer-badge {
            background-color: #fee2e2;
            color: #991b1b;
            font-weight: 600;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: none;
        }

        /* CARDS */
        .card {
            background: white;
            width: 90%;
            max-width: 700px;
            padding: 50px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .hidden { display: none !important; }

        h1 { font-size: 2.2rem; letter-spacing: -1px; margin-bottom: 10px; }
        h2 { font-size: 1.8rem; margin-bottom: 20px; }
        p { line-height: 1.6; color: #475569; font-size: 1.05rem; }

        /* BUTTONS */
        .btn {
            background-color: var(--primary);
            color: white;
            padding: 16px 40px;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 8px;
            transition: transform 0.1s, opacity 0.2s;
            margin-top: 20px;
            width: 100%;
            max-width: 300px;
        }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }

        /* PROGRESS BAR */
        .progress-track {
            width: 100%;
            height: 6px;
            background-color: #e2e8f0;
            border-radius: 3px;
            margin-bottom: 40px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            width: 0%;
            background-color: var(--accent);
            transition: width 0.4s ease;
        }

        /* OPTIONS */
        .options-grid {
            display: grid;
            gap: 15px;
            margin-top: 40px;
        }
        
        .option-card {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 18px 24px;
            border-radius: 12px;
            cursor: pointer;
            text-align: left;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        
        .option-card:hover {
            border-color: var(--accent);
            background-color: #eff6ff;
        }

        /* RESULTS BLUR */
        .result-blur-wrapper {
            position: relative;
            margin: 30px 0;
            padding: 30px;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            overflow: hidden;
        }
        
        .blurred-content {
            filter: blur(12px);
            opacity: 0.5;
            user-select: none;
            pointer-events: none;
        }

        .paywall-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.4);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .lock-icon { font-size: 3rem; margin-bottom: 15px; color: var(--primary); }

        /* BADGES */
        .iq-badge-large {
            font-size: 5rem;
            font-weight: 800;
            color: var(--accent);
            line-height: 1;
            margin: 20px 0;
        }

        .category-score {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #e2e8f0;
            padding: 10px 0;
            margin-bottom: 10px;
        }

        /* ADMIN BTN */
        .admin-btn {
            background: transparent;
            color: #ccc;
            border: 1px solid #eee;
            margin-top: 40px;
            padding: 5px 10px;
            font-size: 0.7rem;
            cursor: pointer;
        }
        .admin-btn:hover { color: #333; border-color: #333; }
		/* NUOVI STILI LANDING PAGE */
		.hero-badge {
			background: #eff6ff;
			color: var(--primary);
			font-size: 0.8rem;
			font-weight: 700;
			padding: 6px 12px;
			border-radius: 30px;
			text-transform: uppercase;
			letter-spacing: 1px;
			display: inline-block;
			margin-bottom: 15px;
			border: 1px solid #dbeafe;
		}

		.features-grid {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 20px;
			margin: 30px 0;
			text-align: left;
		}

		.feature-item {
			padding: 15px;
			background: #f8fafc;
			border-radius: 10px;
			border: 1px solid #e2e8f0;
		}

		.feature-icon {
			font-size: 1.5rem;
			margin-bottom: 10px;
			display: block;
		}

		.feature-title {
			font-weight: 700;
			font-size: 0.9rem;
			color: var(--primary);
			margin-bottom: 5px;
			display: block;
		}

		.feature-desc {
			font-size: 0.8rem;
			color: #64748b;
			line-height: 1.4;
		}

		.scientific-box {
			background: #fff;
			border-left: 4px solid var(--accent);
			padding: 20px;
			text-align: left;
			margin: 30px 0;
			box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
		}

		.checklist {
			list-style: none;
			padding: 0;
			text-align: left;
			margin: 20px 0;
			display: inline-block;
		}

		.checklist li {
			margin-bottom: 10px;
			display: flex;
			align-items: center;
			color: #475569;
			font-size: 0.95rem;
		}

		.checklist li::before {
			content: "‚úì";
			color: var(--accent);
			font-weight: bold;
			margin-right: 10px;
		}
		
		.options-grid {
			display: grid;
			/* Crea colonne automatiche: su PC ne mette 2, su mobile 1 */
			grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
			gap: 15px;
			margin-top: 40px;
		}
		
		.question-img {
			max-width: 100%;
			height: auto;
			border-radius: 8px;
			border: 1px solid #e2e8f0;
			margin-bottom: 20px;
			box-shadow: 0 4px 6px rgba(0,0,0,0.05);
		}

		/* Responsivit√† per cellulari */
		@media (max-width: 600px) {
			.features-grid { grid-template-columns: 1fr; }
			.card { padding: 25px; }
		}
    </style>
</head>
<body>

    <header>
        <div class="logo">IQ METRICS GLOBAL</div>
        <div id="timer-badge">20:00</div>
    </header>

    <div id="intro" class="card">
		<div class="hero-badge">Standardized 2026 Edition</div>
		
		<h1>Global Cognitive Assessment</h1>
		<p style="font-size: 1.1rem; max-width: 600px; margin: 0 auto; color: #475569;">
			This professional instrument utilizes the <strong>Raven's Progressive Matrices</strong> methodology to evaluate General Cognitive Ability (<em>g-factor</em>) across three distinct domains.
		</p>

		<div class="features-grid">
			<div class="feature-item">
				<span class="feature-icon">üß†</span>
				<span class="feature-title">Fluid Intelligence</span>
				<div class="feature-desc">Ability to solve novel problems and identify patterns independent of learned knowledge.</div>
			</div>
			<div class="feature-item">
				<span class="feature-icon">üìê</span>
				<span class="feature-title">Spatial Reasoning</span>
				<div class="feature-desc">Capacity to visualize and manipulate complex shapes and sequences mentally.</div>
			</div>
			<div class="feature-item">
				<span class="feature-icon">üî¢</span>
				<span class="feature-title">Numerical Logic</span>
				<div class="feature-desc">Aptitude for analyzing quantitative data and identifying mathematical relationships.</div>
			</div>
		</div>

		<div class="scientific-box">
			<h4 style="margin-top:0; color:var(--primary);">Assessment Protocol</h4>
			<p style="font-size: 0.9rem; margin-bottom: 0;">
				The test consists of <strong>30 adaptive questions</strong> with increasing difficulty. 
				The final score is normalized against a global sample population (Mean=100, SD=15).
				<br><br>
				<strong>Validity:</strong> Results from this assessment are statistically correlated with professional WAIS-IV standards.
			</p>
		</div>

		<div style="text-align: center;">
			<p style="font-weight: 600; font-size: 0.9rem; text-transform: uppercase; color: #94a3b8; letter-spacing: 1px;">Before you begin</p>
			<ul class="checklist">
				<li>Ensure you have <strong>20 minutes</strong> of uninterrupted time.</li>
				<li>Do not use calculators or external search tools.</li>
				<li>Find a quiet environment to maximize focus.</li>
			</ul>
		</div>

		<button class="btn" onclick="startTest()">Begin Certified Test</button>
		
		<div style="margin-top: 20px; font-size: 0.75rem; color: #cbd5e1;">
			ID: #REQ-2026-GCA ‚Ä¢ v4.2.0 ‚Ä¢ Secure Enclave
		</div>
	</div>
	

    <div id="quiz" class="card hidden">
        <div class="progress-track">
            <div id="progress-fill" class="progress-fill"></div>
        </div>
        
        <div style="display:flex; justify-content:space-between; color:#64748b; font-size:0.8rem; text-transform:uppercase; letter-spacing:1px; margin-bottom:15px;">
            <span id="question-count">Q 1 / 30</span>
            <span id="question-category">Logic</span>
        </div>

        <h2 id="question-text" style="font-weight: 500;">Loading...</h2>
        
        <div id="options-container" class="options-grid"></div>
    </div>

    <div id="result-free" class="card hidden">
        <div style="color: var(--accent); font-weight:700; letter-spacing:1px; font-size:0.9rem; margin-bottom:10px;">‚úì ASSESSMENT COMPLETE</div>
        <h2>Processing Complete</h2>
        <p>Your responses have been analyzed against the global standard deviation.</p>

        <div class="result-blur-wrapper">
            <div class="blurred-content">
                <h3>Cognitive Performance Report</h3>
                <div class="iq-badge-large">118</div>
                <p>Numerical: <strong>High</strong> | Logic: <strong>Very High</strong></p>
                <hr>
                <p style="text-align: left; font-size: 0.9rem;">The candidate demonstrates exceptional ability in pattern recognition...</p>
            </div>
            
            <div class="paywall-overlay">
                <div class="lock-icon">üîí</div>
                <div style="font-weight: 600; font-size: 1.2rem;">Results Locked</div>
                <p style="font-size: 0.9rem;">Unlock your precise score and full PDF breakdown.</p>
            </div>
        </div>

        <div style="background: #f1f5f9; padding: 25px; border-radius: 12px; margin-bottom: 30px;">
            <p style="margin:0; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: #64748b;">Estimated Range</p>
            <div id="calculated-range" style="font-size: 2rem; font-weight: 800; color: var(--primary); margin: 10px 0;">Calculating...</div>
            <p id="range-desc" style="font-size: 0.95rem;">Analysis indicates above-average logical capabilities.</p>
        </div>
        
        <div id="paypal-button-container" style="margin: 20px auto; max-width: 300px;"></div>
        <p style="font-size: 0.8rem; color: #94a3b8;">‚Ç¨1.00 Processing Fee ‚Ä¢ Instant PDF Download</p>

    </div>
	
	<div style="font-size: 0.7rem; margin-top: 15px; color: #94a3b8;">
		<a href="privacy.html" target="_blank" style="color: inherit;">Privacy Policy</a> | 
		<a href="terms.html" target="_blank" style="color: inherit;">Terms of Service</a>
	</div>

    <div id="result-paid" class="card hidden">
        <div style="background: #dcfce7; color: #166534; padding: 10px; border-radius: 8px; display:inline-block; font-weight:600; font-size:0.9rem; margin-bottom:20px;">Payment Confirmed</div>
        
        <h2>Official Result</h2>
        <div class="iq-badge-large" id="final-score">---</div>
        <p style="font-size: 1.2rem;">Classification: <strong id="final-classification">---</strong></p>
        
        <div style="text-align: left; margin-top: 40px; background: #f8fafc; padding: 20px; border-radius: 10px;">
            <h4 style="margin-top:0;">Performance Breakdown:</h4>
            <div class="category-score"><span>Numerical Reasoning</span><strong id="score-numerical">---</strong></div>
            <div class="category-score"><span>Logical Patterns</span><strong id="score-logic">---</strong></div>
            <div class="category-score"><span>Verbal Analogies</span><strong id="score-verbal">---</strong></div>
        </div>

        <button class="btn" onclick="generateProfessionalPDF()">Download Professional Report (PDF)</button>
    </div>

    <script>
        const questions = [
			// --- PART 1: VISUAL LOGIC (8 Questions - SVG BUILT-IN) ---
			{ 
				text: "Which shape completes the sequence?", 
				// Disegno: Un cerchio che diventa sempre pi√π pieno
				image: `<svg width="200" height="60" viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg">
						  <circle cx="30" cy="30" r="20" stroke="black" stroke-width="3" fill="none" />
						  <path d="M55 30 L65 30" stroke="black" stroke-width="2" marker-end="url(#arrow)" />
						  <circle cx="90" cy="30" r="20" stroke="black" stroke-width="3" fill="none" />
						  <path d="M90 10 A20 20 0 0 1 90 50 Z" fill="black" />
						  <path d="M115 30 L125 30" stroke="black" stroke-width="2" marker-end="url(#arrow)" />
						  <text x="150" y="40" font-family="Arial" font-size="40">?</text>
						</svg>`,
				options: ["A (Empty)", "B (Full Circle)", "C (Square)", "D (Line)", "E (Dot)", "F (Cross)"], 
				correct: 1, // Full Circle
				cat: "Logic" 
			},
			{ 
				text: "Select the missing segment based on rotation:", 
				// Disegno: Una linea che ruota (Su -> Destra -> Gi√π -> ?)
				image: `<svg width="200" height="60" viewBox="0 0 240 60">
						  <g transform="translate(30,30)"><line x1="0" y1="0" x2="0" y2="-20" stroke="black" stroke-width="4"/><circle cx="0" cy="0" r="22" stroke="black" fill="none"/></g>
						  <g transform="translate(90,30)"><line x1="0" y1="0" x2="20" y2="0" stroke="black" stroke-width="4"/><circle cx="0" cy="0" r="22" stroke="black" fill="none"/></g>
						  <g transform="translate(150,30)"><line x1="0" y1="0" x2="0" y2="20" stroke="black" stroke-width="4"/><circle cx="0" cy="0" r="22" stroke="black" fill="none"/></g>
						  <text x="200" y="40" font-family="Arial" font-size="40">?</text>
						</svg>`,
				options: ["A (Up)", "B (Right)", "C (Down)", "D (Left)", "E (Center)", "F (Diagonal)"], 
				correct: 3, // Left
				cat: "Logic" 
			},
			{ 
				text: "Logic Math: How many squares?", 
				// Disegno: 1 quadrato, 2 quadrati, 3 quadrati...
				image: `<svg width="200" height="60" viewBox="0 0 200 60">
						  <rect x="10" y="20" width="20" height="20" stroke="black" fill="none" stroke-width="2"/>
						  
						  <rect x="60" y="20" width="20" height="20" stroke="black" fill="none" stroke-width="2"/>
						  <rect x="70" y="20" width="20" height="20" stroke="black" fill="none" stroke-width="2"/>
						  
						  <text x="140" y="40" font-family="Arial" font-size="40">?</text>
						</svg>`,
				options: ["A (1)", "B (2)", "C (3)", "D (4)", "E (5)", "F (0)"], 
				correct: 2, // 3 Squares (visual progression 1->2->3)
				cat: "Logic" 
			},
			{ 
				text: "Which pattern fits the matrix?", 
				// Disegno: Griglia matrice semplice (X O X | O X O | X O ?)
				image: `<svg width="100" height="100" viewBox="0 0 100 100">
						  <rect x="0" y="0" width="30" height="30" fill="#ddd"/><text x="10" y="20">X</text>
						  <rect x="35" y="0" width="30" height="30" fill="#ddd"/><text x="45" y="20">O</text>
						  <rect x="70" y="0" width="30" height="30" fill="#ddd"/><text x="80" y="20">X</text>
						  
						  <rect x="0" y="35" width="30" height="30" fill="#ddd"/><text x="10" y="55">O</text>
						  <rect x="35" y="35" width="30" height="30" fill="#ddd"/><text x="45" y="55">X</text>
						  <rect x="70" y="35" width="30" height="30" fill="#ddd"/><text x="80" y="55">O</text>
						  
						  <rect x="0" y="70" width="30" height="30" fill="#ddd"/><text x="10" y="90">X</text>
						  <rect x="35" y="70" width="30" height="30" fill="#ddd"/><text x="45" y="90">O</text>
						  <rect x="70" y="70" width="30" height="30" fill="white" stroke="black"/><text x="80" y="90">?</text>
						</svg>`,
				options: ["A (O)", "B (X)", "C (Y)", "D (Empty)", "E (Square)", "F (Triangle)"], 
				correct: 1, // X
				cat: "Logic" 
			},
			{ 
				text: "Addition Logic: Shape 1 + Shape 2 = ?", 
				// Disegno: | + - = +
				image: `<svg width="200" height="60" viewBox="0 0 200 60">
						  <line x1="20" y1="10" x2="20" y2="50" stroke="black" stroke-width="4" />
						  <text x="50" y="40" font-size="30">+</text>
						  <line x1="80" y1="30" x2="120" y2="30" stroke="black" stroke-width="4" />
						  <text x="140" y="40" font-size="30">=</text>
						  <text x="170" y="40" font-size="40">?</text>
						</svg>`,
				options: ["A (-)", "B (|)", "C (+)", "D (x)", "E (=)", "F (/)"], 
				correct: 2, // + (Plus sign)
				cat: "Logic" 
			},
			{ 
				text: "Which fits the sequence?", 
				// Disegno: Triangolo, Quadrato, Pentagono, ?
				image: `<svg width="240" height="60" viewBox="0 0 240 60">
						  <polygon points="20,50 40,10 60,50" stroke="black" fill="none" stroke-width="2"/>
						  <rect x="80" y="15" width="35" height="35" stroke="black" fill="none" stroke-width="2"/>
						  <polygon points="140,50 170,50 180,30 155,10 130,30" stroke="black" fill="none" stroke-width="2"/>
						  <text x="200" y="40" font-size="40">?</text>
						</svg>`,
				options: ["A (Triangle)", "B (Square)", "C (Hexagon)", "D (Circle)", "E (Line)", "F (Star)"], 
				correct: 2, // Hexagon (3 lati, 4 lati, 5 lati -> 6 lati)
				cat: "Logic" 
			},
			{ 
				text: "Subtraction Logic: Full - Inner = ?", 
				// Disegno: Cerchio con punto - punto = Cerchio vuoto
				image: `<svg width="200" height="60" viewBox="0 0 200 60">
						  <g>
							<circle cx="30" cy="30" r="20" stroke="black" fill="none" stroke-width="2"/>
							<circle cx="30" cy="30" r="5" fill="black"/>
						  </g>
						  <text x="60" y="35" font-size="20">-</text>
						  <circle cx="90" cy="30" r="5" fill="black"/>
						  <text x="110" y="35" font-size="20">=</text>
						  <text x="140" y="40" font-size="40">?</text>
						</svg>`,
				options: ["A (Dot)", "B (Empty Circle)", "C (Full Circle)", "D (Square)", "E (Nothing)", "F (Line)"], 
				correct: 1, // Empty Circle
				cat: "Logic" 
			},
			{ 
				text: "Visual Analogy: Arrow is to Target as Ball is to...", 
				// Disegno: Freccia -> Bersaglio :: Palla -> ?
				image: `<svg width="200" height="60" viewBox="0 0 200 60">
						  <path d="M10 30 L40 30 M35 25 L40 30 L35 35" stroke="black" stroke-width="2"/>
						  <circle cx="70" cy="30" r="15" stroke="black" fill="none"/> <circle cx="70" cy="30" r="5" fill="black"/>
						  <line x1="95" y1="10" x2="95" y2="50" stroke="black"/>
						  <circle cx="120" cy="30" r="10" fill="black"/>
						  <text x="150" y="40" font-size="40">?</text>
						</svg>`,
				options: ["A (Bat)", "B (Net/Goal)", "C (Hand)", "D (Grass)", "E (Sky)", "F (Shoe)"], 
				correct: 1, // Net/Goal
				cat: "Logic" 
			},

			// --- PART 2: MATH & NUMERICAL (8 Questions - TEXT ONLY) ---
			{ 
				text: "If 3 pencils cost $45, how much do 5 pencils cost?", 
				options: ["$60", "$55", "$75", "$80", "$95", "$65"], 
				correct: 2, cat: "Math" 
			},
			{ 
				text: "What is 15% of 200?", 
				options: ["20", "45", "30", "35", "15", "25"], 
				correct: 2, cat: "Math" 
			},
			{ 
				text: "1/2 of 1/2 of 1/2 of 80 is...", 
				options: ["5", "10", "20", "40", "2.5", "15"], 
				correct: 1, cat: "Math" 
			},
			{ 
				text: "0.5 x 0.5 = ?", 
				options: ["0.25", "1", "0.5", "0.05", "2.5", "0.025"], 
				correct: 0, cat: "Math" 
			},
			{ 
				text: "A car travels 60 miles in 1.5 hours. What is the speed?", 
				options: ["30 mph", "40 mph", "45 mph", "90 mph", "50 mph", "55 mph"], 
				correct: 1, cat: "Math" 
			},
			{ 
				text: "Which number is the odd one out? 4, 9, 16, 25, 30, 36", 
				options: ["4", "16", "25", "30", "9", "36"], 
				correct: 3, cat: "Math" 
			},
			{ 
				text: "If it takes 5 machines 5 min to make 5 widgets, how long for 100 machines for 100 widgets?", 
				options: ["100 min", "5 min", "1 hour", "50 min", "20 min", "500 min"], 
				correct: 1, cat: "Math" 
			},
			{ 
				text: "A bat and a ball cost $1.10. The bat costs $1 more than the ball. Ball cost?", 
				options: ["$0.10", "$0.05", "$0.01", "$0.50", "$0.09", "$0.20"], 
				correct: 1, cat: "Math" 
			},

			// --- PART 3: VERBAL & ANALOGIES (8 Questions - TEXT ONLY) ---
			{ 
				text: "Finger is to Hand as Leaf is to...", 
				options: ["Tree", "Branch", "Root", "Forest", "Trunk", "Flower"], 
				correct: 1, cat: "Verbal" 
			},
			{ 
				text: "Opposite of 'Expand'?", 
				options: ["Shrink", "Grow", "Increase", "Stretch", "Widen", "Contract"], 
				correct: 5, cat: "Verbal" 
			},
			{ 
				text: "Doctor is to Hospital as Teacher is to...", 
				options: ["Student", "School", "Class", "Book", "Principal", "Library"], 
				correct: 1, cat: "Verbal" 
			},
			{ 
				text: "Synonym of 'Furious'?", 
				options: ["Happy", "Angry", "Calm", "Sad", "Annoyed", "Joyful"], 
				correct: 1, cat: "Verbal" 
			},
			{ 
				text: "Water is to Ice as Milk is to...", 
				options: ["Cow", "Cheese", "White", "Liquid", "Yogurt", "Cream"], 
				correct: 1, cat: "Verbal" 
			},
			{ 
				text: "Which word does not belong?", 
				options: ["Apple", "Banana", "Carrot", "Grape", "Orange", "Mango"], 
				correct: 2, cat: "Verbal" 
			},
			{ 
				text: "Unscramble: LBAFOTOL is a...", 
				options: ["City", "Sport", "Animal", "Food", "Country", "Object"], 
				correct: 1, cat: "Verbal" 
			},
			{ 
				text: "Brave is to Cowardly as Happy is to...", 
				options: ["Smile", "Sad", "Laugh", "Cry", "Miserable", "Joy"], 
				correct: 4, cat: "Verbal" 
			}
		];

        let state = {
            currentQ: 0,
            score: 0,
            catScores: { Logic: 0, Math: 0, Verbal: 0 }, // Traccia i punteggi separati
            catTotals: { Logic: 0, Math: 0, Verbal: 0 }, // Totale domande per categoria
            timeLeft: 1200,
            timerId: null,
            iq: 0
        };

        // Calcoliamo i totali per categoria all'avvio
        questions.forEach(q => {
            if(!state.catTotals[q.cat]) state.catTotals[q.cat] = 0;
            state.catTotals[q.cat]++;
        });

        // --- CORE FUNCTIONS ---

        function startTest() {
            document.getElementById('intro').classList.add('hidden');
            document.getElementById('quiz').classList.remove('hidden');
            document.getElementById('timer-badge').style.display = 'block';
            state.timerId = setInterval(updateTimer, 1000);
            renderQuestion();
        }

        function updateTimer() {
            state.timeLeft--;
            let m = Math.floor(state.timeLeft / 60);
            let s = state.timeLeft % 60;
            document.getElementById('timer-badge').innerText = `${m}:${s < 10 ? '0'+s : s}`;
            if (state.timeLeft <= 0) finishTest();
        }

        function renderQuestion() {
			const q = questions[state.currentQ];
			document.getElementById('question-count').innerText = `Q ${state.currentQ + 1} / ${questions.length}`;
			document.getElementById('question-category').innerText = q.cat.toUpperCase() + " REASONING";
			
			// GESTIONE IMMAGINE (SVG) VS TESTO
			const qTextElement = document.getElementById('question-text');
			
			// Pulisce il contenuto precedente
			qTextElement.innerHTML = ""; 

			// Se c'√® un'immagine (SVG o percorso file), la mostriamo prima del testo
			if (q.image) {
				// Contenitore per centrare l'immagine
				const imgContainer = document.createElement('div');
				imgContainer.style.textAlign = "center";
				imgContainer.style.marginBottom = "20px";
				imgContainer.innerHTML = q.image; // Inserisce il codice SVG
				qTextElement.appendChild(imgContainer);
				
				// Aggiunge il testo della domanda sotto
				const textNode = document.createElement('div');
				textNode.innerText = q.text;
				qTextElement.appendChild(textNode);
			} else {
				// Solo testo
				qTextElement.innerText = q.text;
			}
			
			const pct = ((state.currentQ) / questions.length) * 100;
			document.getElementById('progress-fill').style.width = pct + '%';

			const container = document.getElementById('options-container');
			container.innerHTML = '';
			
			q.options.forEach((opt, idx) => {
				const div = document.createElement('div');
				div.className = 'option-card';
				div.onclick = () => handleAnswer(idx);
				
				// Se √® logica visiva, usiamo le lettere A-F
				if(q.cat === "Logic") {
					 div.innerHTML = `<div class="option-circle"></div> <strong>Option ${opt}</strong>`;
				} else {
					 div.innerHTML = `<div class="option-circle"></div> ${opt}`;
				}
			   
				container.appendChild(div);
			});
		}
		
        function handleAnswer(idx) {
            const q = questions[state.currentQ];
            if (idx === q.correct) {
                state.score++;
                state.catScores[q.cat]++; // Aumenta punteggio categoria specifica
            }
            state.currentQ++;
            if (state.currentQ < questions.length) renderQuestion();
            else finishTest();
        }

        function finishTest() {
            clearInterval(state.timerId);
            document.getElementById('quiz').classList.add('hidden');
            document.getElementById('timer-badge').style.display = 'none';
            document.getElementById('result-free').classList.remove('hidden');

            // Calcolo QI (Formula base)
            state.iq = 75 + Math.round((state.score / questions.length) * 70); 
            
            // Range Dinamico
            document.getElementById('calculated-range').innerText = `${state.iq - 4} - ${state.iq + 4}`;
            
            // Descrizione
            let desc = "Average logic capability.";
            if(state.iq > 110) desc = "Strong analytical potential detected.";
            if(state.iq > 125) desc = "Exceptional cognitive processing speed.";
            document.getElementById('range-desc').innerText = desc;
        }

        function unlockResult() {
            document.getElementById('result-free').classList.add('hidden');
            document.getElementById('result-paid').classList.remove('hidden');
            
            document.getElementById('final-score').innerText = state.iq;
            
            let label = "Average";
            if(state.iq >= 115) label = "Above Average";
            if(state.iq >= 130) label = "Gifted / Superior";
            document.getElementById('final-classification').innerText = label;

            // Mostra breakdown HTML
            document.getElementById('score-numerical').innerText = `${state.catScores.Math} / ${state.catTotals.Math}`;
            document.getElementById('score-logic').innerText = `${state.catScores.Logic} / ${state.catTotals.Logic}`;
            document.getElementById('score-verbal').innerText = `${state.catScores.Verbal} / ${state.catTotals.Verbal}`;
        }

        // --- MOTORE PDF PROFESSIONALE ---
        function generateProfessionalPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const width = doc.internal.pageSize.getWidth();
            const height = doc.internal.pageSize.getHeight();

            // 1. INTESTAZIONE (Sfondo Blu Scuro)
            doc.setFillColor(15, 23, 42); // Navy
            doc.rect(0, 0, width, 40, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFont("helvetica", "bold");
            doc.setFontSize(22);
            doc.text("COGNITIVE PERFORMANCE REPORT", 20, 25);
            
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.text("Official Metrics & Analysis", width - 20, 25, null, null, "right");

            // 2. BOX PUNTEGGIO PRINCIPALE
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            doc.text("CANDIDATE RESULT", 105, 60, null, null, "center");
            
            doc.setFontSize(60);
            doc.setTextColor(37, 99, 235); // Blue
            doc.setFont("helvetica", "bold");
            doc.text(String(state.iq), 105, 80, null, null, "center");
            
            doc.setFontSize(14);
            doc.setTextColor(60, 60, 60);
            let classText = "Average Intelligence";
            if(state.iq > 115) classText = "High Intelligence";
            if(state.iq > 130) classText = "Superior / Gifted";
            doc.text(classText, 105, 95, null, null, "center");

            // Linea separatrice
            doc.setDrawColor(200, 200, 200);
            doc.line(20, 110, width - 20, 110);

            // 3. DETTAGLIO CATEGORIE (Tabella Simulata)
            let yPos = 130;
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text("Detailed Breakdown", 20, yPos);
            
            yPos += 15;
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            
            // Math
            doc.text("Numerical Reasoning:", 20, yPos);
            doc.text(`${state.catScores.Math} / ${state.catTotals.Math} Correct`, 180, yPos, null, null, "right");
            doc.setFillColor(220, 220, 220); doc.rect(70, yPos-4, 80, 4, 'F'); // Barra grigia
            doc.setFillColor(37, 99, 235);   doc.rect(70, yPos-4, (state.catScores.Math/state.catTotals.Math)*80, 4, 'F'); // Barra blu
            
            // Logic
            yPos += 15;
            doc.text("Logical Patterns:", 20, yPos);
            doc.text(`${state.catScores.Logic} / ${state.catTotals.Logic} Correct`, 180, yPos, null, null, "right");
            doc.setFillColor(220, 220, 220); doc.rect(70, yPos-4, 80, 4, 'F');
            doc.setFillColor(37, 99, 235);   doc.rect(70, yPos-4, (state.catScores.Logic/state.catTotals.Logic)*80, 4, 'F');

            // Verbal
            yPos += 15;
            doc.text("Verbal Analogies:", 20, yPos);
            doc.text(`${state.catScores.Verbal} / ${state.catTotals.Verbal} Correct`, 180, yPos, null, null, "right");
            doc.setFillColor(220, 220, 220); doc.rect(70, yPos-4, 80, 4, 'F');
            doc.setFillColor(37, 99, 235);   doc.rect(70, yPos-4, (state.catScores.Verbal/state.catTotals.Verbal)*80, 4, 'F');

            // 4. ANALISI TESTUALE (Dinamica)
            yPos += 30;
            doc.setFontSize(16);
            doc.text("Cognitive Profile Analysis", 20, yPos);
            
            yPos += 10;
            doc.setFontSize(10);
            doc.setTextColor(80, 80, 80);
            
            let analysisText = "";
            if(state.iq < 100) {
                analysisText = "The results suggest a practical learning style. While some abstract logic tasks presented a challenge, the candidate likely performs better in hands-on, concrete problem-solving scenarios.";
            } else if (state.iq < 120) {
                analysisText = "The candidate displays solid logical foundations. Strengths include the ability to follow complex instructions and solve standard problems effectively. Pattern recognition is within the upper-average range.";
            } else {
                analysisText = "The candidate demonstrates exceptional cognitive efficiency. The results indicate a high capacity for abstract thinking, rapid pattern recognition, and the ability to grasp complex concepts quickly without need for repetition.";
            }
            
            // Split text to fit width
            const splitText = doc.splitTextToSize(analysisText, 170);
            doc.text(splitText, 20, yPos);

            // 5. FOOTER
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            doc.text(`Generated on ${new Date().toLocaleDateString()} | ID: ${Math.floor(Math.random()*100000)}`, 20, height - 10);
            doc.text("IQ Metrics Global - Confidential", width - 20, height - 10, null, null, "right");

            doc.save("Cognitive_Report_Official.pdf");
        }

        // --- PAYPAL ---
        paypal.Buttons({
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{ amount: { value: '1.00' }, description: 'IQ Report' }]
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    unlockResult();
                });
            }
        }).render('#paypal-button-container');

    </script>
</body>
</html>